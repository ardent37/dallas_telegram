<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Abrir en navegador / Telegram</title>
<style>
  :root{--bg:#071133;--card:rgba(255,255,255,0.03);--accent:#2A9D8F;}
  html,body{height:100%;margin:0;font-family:system-ui,Arial; background:linear-gradient(180deg,#0b1226 0%, #071133 100%); color:#fff;}
  .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:20px;}
  .card{width:100%;max-width:480px;background:var(--card);padding:28px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
  h1{margin:0 0 8px;font-size:20px;}
  p{margin:0 0 14px;color:rgba(255,255,255,0.9);}
  button{width:100%;padding:14px;border-radius:10px;border:0;font-size:17px;cursor:pointer;margin-top:8px;}
  .primary{background:var(--accent);color:#fff;}
  .muted{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;}
  .hint{font-size:13px;color:rgba(255,255,255,0.85);margin-top:12px;}
  .small{font-size:13px;opacity:0.9;margin-top:8px;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Abrir Telegram">
      <h1>Abrir Telegram</h1>
      <p>Pulsa el botón para intentar abrir Telegram en la app o, si procede, abrir la URL en tu navegador (Chrome/Safari).</p>

      <button id="openBtn" class="primary">Abrir ahora (recomendado)</button>
      <button id="openInChromeBtn" class="muted">Forzar intento en Chrome (Android)</button>
      <button id="copyBtn" class="muted">Copiar enlace</button>

      <p class="hint">Si estás en la app de TikTok y no funciona: abre el menú ⋯ del reproductor y selecciona "Abrir en navegador" o pega el enlace en Chrome/Safari.</p>
      <p class="small" id="status"></p>
    </div>
  </div>

<script>
(function(){
  // --- CONFIG ----
  const token = 'U3v7NGhiUlk5NDAx'; // tu token
  const tmeUrl = 'https://t.me/+' + token;
  const tgScheme = 'tg://join?invite=' + token;

  // Intent para Chrome en Android: intenta abrir https://t.me/+
  // Nota: los intent pueden ser ignorados por el webview si éste lo bloquea.
  function chromeIntentUrl(url){
    // Para intent la "path" va después de intent:// y scheme indica 'https'
    // Ejemplo: intent://t.me/+TOKEN#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=...;end
    // Algunos navegadores aceptan diferentes formas; ponemos el fallback encoded.
    return 'intent://t.me/+' + token +
           '#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=' +
           encodeURIComponent(url) + ';end';
  }

  // detección simple
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);

  const status = document.getElementById('status');

  function openWithIntentFallback() {
    status.textContent = 'Intentando abrir Chrome / Telegram...';
    // First try: if Android, request Chrome via intent:
    if (isAndroid) {
      // abrir intent que pide Chrome
      window.location.href = chromeIntentUrl(tmeUrl);
      // set fallback to open tg:// after short delay (in case intent ignored)
      setTimeout(function(){
        tryOpenTGThenWeb();
      }, 900);
      return;
    }
    // Non-Android: try tg:// then web fallback
    tryOpenTGThenWeb();
  }

  function tryOpenTGThenWeb() {
    status.textContent = 'Intentando abrir la app Telegram...';
    // registrar visibilitychange: si la página se oculta, asumimos que la app tomó foco y no hacemos fallback
    let fallbackTimer;
    const start = Date.now();
    function cleanup(){ document.removeEventListener('visibilitychange', onVis); clearTimeout(fallbackTimer); }
    function onVis(){ if (document.hidden) { cleanup(); status.textContent = 'App abierta (si está instalada).'; } }

    document.addEventListener('visibilitychange', onVis);

    // Intentamos esquema tg://
    try {
      window.location.href = tgScheme;
    } catch (e) {
      // nothing
    }

    // Si no se cambió de visibilidad en ~1200ms, abrimos el web fallback en nueva pestaña
    fallbackTimer = setTimeout(function(){
      document.removeEventListener('visibilitychange', onVis);
      if (!document.hidden && Date.now() - start < 3000) {
        // Abrir en nueva pestaña (si el webview lo permite)
        try { window.open(tmeUrl, '_blank', 'noopener'); } catch(e){ /* ignore */ }
        status.textContent = 'Se abrió el enlace web como fallback.';
      }
    }, 1200);
  }

  // botón principal: intenta primero abrir Telegram (tg://) y fallback al web
  document.getElementById('openBtn').addEventListener('click', function(e){
    e.preventDefault();
    openWithIntentFallback();
  });

  // botón específico: fuerza intent para Chrome (útil para Android)
  document.getElementById('openInChromeBtn').addEventListener('click', function(e){
    e.preventDefault();
    if (!isAndroid) {
      status.textContent = 'Esta opción solo aplica en Android (Chrome). Se usará otro método.';
      openWithIntentFallback();
      return;
    }
    status.textContent = 'Intentando abrir Chrome...';
    // Intent directo a Chrome
    window.location.href = chromeIntentUrl(tmeUrl);
    // fallback: tg then web
    setTimeout(function(){ tryOpenTGThenWeb(); }, 900);
  });

  // copiar enlace
  document.getElementById('copyBtn').addEventListener('click', function(){
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(tmeUrl).then(function(){
        status.textContent = 'Enlace copiado al portapapeles.';
      }, function(){
        status.textContent = 'No se pudo copiar automáticamente. Mantén pulsado el enlace y copia.';
        alert('Copia manualmente: ' + tmeUrl);
      });
    } else {
      prompt('Copia este enlace:', tmeUrl);
    }
  });

  // opcional: mostrar token en consola para debug
  console.log('t.me link:', tmeUrl, 'tg scheme:', tgScheme);
})();
</script>
</body>
</html>
